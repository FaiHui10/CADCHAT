# CADCHAT 部署指南

本文档详细介绍了CADCHAT项目的两种部署方式，包括对比、配置和决策指导，帮助您选择最适合的部署方案。

## 部署方式概览

| 特性 | 局域网部署 (server/) | 阿里云部署 (aliserver/) |
|------|---------------------|-------------------------|
| 目录位置 | `server/` | `aliserver/` |
| 适用场景 | 内网环境、数据安全要求高 | 云端部署、无高性能硬件 |
| 数据安全 | 数据完全本地化 | 数据传输至云端API |
| 硬件要求 | 高（需GPU、大内存） | 低（仅需基础服务器） |
| 网络要求 | 局域网内访问 | 需要互联网连接 |
| 维护成本 | 较高（需维护本地模型） | 较低（云端服务） |
| 成本模型 | 一次性硬件投资 | API调用按量付费 |
| 性能表现 | 本地计算，延迟较低 | 云端计算，受网络影响 |
| 模型类型 | 本地Ollama+bge-m3 | 阿里云text-embedding-v4 |
| Docker支持 | ❌ 不支持 | ✅ 支持 |
| 部署方式 | 直接运行Python脚本 | 直接运行或Docker部署 |

## 技术架构对比

### 局域网部署 (server/)
- 使用本地Ollama + bge-m3模型
- 所有计算在本地完成
- 依赖GPU加速
- 向量索引本地存储
- 数据完全本地化，无外传风险

### 阿里云部署 (aliserver/)
- 使用阿里云百炼平台API
- 计算任务在云端完成
- 依赖网络连接质量
- 向量索引在云端管理
- 专业云安全保障

## 硬件要求

### 局域网部署
```
- CPU: Intel Core i5 或同等性能
- 内存: 8GB+ RAM (推荐16GB+)
- GPU: NVIDIA GPU (RTX 3060+, 8GB显存)
- 存储: 5GB+ 可用空间
- 网络: 局域网连接
```

### 阿里云部署
```
- CPU: 任意现代处理器
- 内存: 2GB+ RAM (推荐4GB+)
- GPU: 无特殊要求
- 存储: 1GB+ 可用空间
- 网络: 稳定互联网连接
```

## 环境变量配置

### 局域网部署配置 (server/.env.example)

局域网部署通常不需要特殊的环境变量，因为所有处理都在本地完成。

### 阿里云部署配置 (aliserver/.env.example)

```env
# 阿里云百炼平台配置
BAILIAN_APP_ID=your-bailian-app-id
DASHSCOPE_API_KEY=your-dashscope-api-key

# Flask服务器配置
FLASK_HOST=0.0.0.0
FLASK_PORT=5000

# 调试模式
DEBUG=False

# 用户代码目录
USER_CODES_FILE=user_codes/user_codes.txt
USER_CODES_DIR=user_codes

# 命令文件路径
COMMAND_FILES_DIR=command_files
AUTOCAD_COMMANDS_FILE=autocad_basic_commands.txt
LISP_COMMANDS_FILE=lisp_commands.txt
```

### 客户端配置 (.env)

```env
# 服务端URL配置 - 根据部署方式选择
CADCHAT_SERVER_URL=http://localhost:5000                    # 本地开发
CADCHAT_SERVER_URL=http://your-local-server-ip:5000        # 局域网部署
CADCHAT_SERVER_URL=http://your-ecs-public-ip:5000          # 阿里云ECS部署

# 请求配置
REQUEST_TIMEOUT=30
MAX_RETRIES=3
```

## 部署决策指导

### 决策流程图

```
您的部署需求
├── 数据安全要求极高？
│   ├── 是 → 局域网部署 (server/)
│   └── 否 → 继续评估
├── 有高性能GPU设备？
│   ├── 是 → 局域网部署 (server/)
│   └── 否 → 阿里云部署 (aliserver/)
├── 预算充足（硬件投资）？
│   ├── 是 → 局域网部署 (server/)
│   └── 否 → 阿里云部署 (aliserver/)
├── 需要离线使用？
│   ├── 是 → 局域网部署 (server/)
│   └── 否 → 可选择任一方式
└── 低频使用？
    ├── 是 → 阿里云部署 (aliserver/)
    └── 否 → 局域网部署 (server/) 或 高性能阿里云实例
```

### 数据安全等级决策

| 安全等级 | 推荐方案 | 理由 |
|----------|----------|------|
| 极高（涉密） | 局域网部署 | 数据完全本地化，无外传风险 |
| 高（内部） | 局域网部署 | 严格内部控制，符合安全政策 |
| 中等 | 阿里云部署 | 专业云安全，成本效益好 |
| 低 | 任一方案 | 根据其他因素决定 |

### 硬件资源决策

| 硬件条件 | 推荐方案 | 说明 |
|----------|----------|------|
| RTX 3060+ | 局域网部署 | 满足本地模型运行要求 |
| 一般配置 | 阿里云部署 | 无需高端硬件 |
| 资源受限 | 阿里云部署 | 低成本解决方案 |

### 使用频率决策

| 使用频率 | 推荐方案 | 考虑因素 |
|----------|----------|----------|
| 高频（>100次/天） | 局域网部署 | 无API调用费用，响应快 |
| 中频（<100次/天） | 阿里云部署 | 成本可控 |
| 低频（偶尔使用） | 阿里云部署 | 按需付费，无需维护 |

## 部署方式详解

### 局域网部署 (server/)

#### 特点
- **本地化**：所有计算在本地完成
- **安全性**：数据不离开本地网络
- **硬件要求**：需要高性能GPU和大内存
- **部署方式**：直接运行Python脚本
- **无Docker**：不提供Docker部署选项

#### 适用场景
- 对数据安全要求极高的环境
- 有足够硬件资源的企业
- 需要低延迟响应的场景
- 网络条件不佳的环境

#### 部署步骤
1. 安装Ollama并下载bge-m3模型
2. 安装Python依赖
3. 启动服务端

### 阿里云部署 (aliserver/)

#### 特点
- **云端计算**：使用阿里云百炼平台
- **轻量化**：对本地硬件要求低
- **部署灵活**：支持直接运行和Docker部署
- **Docker支持**：完整的容器化部署方案

#### 适用场景
- 硬件资源有限的环境
- 需要快速部署的场景
- 云端服务优先的架构
- 小型团队或个人使用

#### 部署步骤
1. 配置阿里云百炼平台API密钥
2. 安装Python依赖
3. 启动服务端（直接运行或Docker）

## 总结

选择部署方式时，建议按照以下优先级考虑：

1. **数据安全要求**：如果数据安全是首要考虑，选择局域网部署
2. **硬件资源**：如果有高性能GPU，可选择局域网部署；否则选择阿里云部署
3. **使用频率**：高频使用建议局域网部署以降低成本，低频使用建议阿里云部署
4. **预算限制**：硬件预算有限时选择阿里云部署
5. **网络条件**：网络不稳定时选择局域网部署